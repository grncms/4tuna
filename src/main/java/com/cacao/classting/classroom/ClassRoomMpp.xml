<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cacao.classting.classroom.ClassRoomMpp">

    <resultMap id="resultMapObj" type="com.cacao.classting.classroom.ClassRoom"></resultMap>
    <sql id = "selectCommonClass">
		 FROM 
		 	ctClass
		 WHERE 1=1
			<choose>
				<when test="shCtcsDelNy ==1">AND ctcsDelNy = 1</when>
				<when test="shCtcsDelNy ==0">AND ctcsDelNy = 0</when>
			</choose>
			<if test="shCtcsName != null and !shCtcsName.equals('')"> AND ctcsName LIKE concat('%',#{shCtcsName},'%')</if>
			<choose>
				<when test="shOption ==1">AND ctcsName LIKE concat('%',#{shValue},'%')</when>
				<when test="shOption ==2">AND ctcsId LIKE concat('%',#{shValue},'%')</when>
			</choose>
			<choose>
		<when test="shOptionDate == 1">AND regDateTime BETWEEN #{shDateStart} AND #{shDateEnd}</when>
		<when test="shOptionDate == 2">AND modDateTime BETWEEN #{shDateStart} AND #{shDateEnd}</when>
	</choose>
    
	</sql>
<select id="selectOneMemberClass" resultMap ="resultMapObj">
			select 
				ctcmName
			 from 
				ctClassMember

			where 1=1
				and ctcmSeq = #{ctcmSeq}
	</select>
	<select id="selectOneCount" resultType="Integer">
			SELECT 
				count(*)
			<include refid="selectCommonClass"/>	
	</select>
	
<update id="updateClass">
			UPDATE
				ctClassMember
			SET 
				ctcmName = #{ctcmName}
				,ctcmAlarmReplyNy = #{ctcmAlarmReplyNy}
				,ctcmAlarmReactionNy = #{ctcmAlarmReactionNy}
				
			WHERE 1=1
				AND ctcmSeq = #{ctcmSeq}
				
	</update>
<delete id="deleteMemberForcely">
		DELETE FROM 
			ctClassMember
		WHERE 1=1
			AND ctcmSeq = #{ctcmSeq}
	</delete>

<select id="selectListClass" resultMap="resultMapObj">
	SELECT 
			ctcsSeq
			,ctcsName
			,ctcsBelongto
			,ctcsCode
			,regDateTime
			,ctcsDelNy
		<include refid="selectCommonClass"/>		
			limit #{startRnumForMysql},#{rowNumToShow} 	
		
	</select>


<select id="selectOneClass" resultMap ="resultMapObj">
			select 
				a.ctcsName
				,a.ctcsBelongto
				,a.ctcsDesc
				,a.regDateTime
				,a.ctcsCode
				,b.ctcmName
			 from 
				ctClass a
			LEFT JOIN ctClassMember b on a.ctcsSeq = b.ctcsSeq
			where 1=1
				and ctcsSeq = #{ctcsSeq}
	</select>

<delete id="deleteClass">
		DELETE FROM 
			ctClass
		WHERE 1=1
			AND ctcsSeq = #{ctcsSeq}
	</delete>
	
<!-- 	클래스내 정보 불러오기! -->
	<select id="selectOneSidebar" resultMap="resultMapObj">
		SELECT
			a.ctcsSeq
			,a.ctcsYear
			,a.ctcsName
			,b.ctcmName
			,b.ctcmTeacherNy
		FROM
			ctClass a
		LEFT JOIN ctClassMember b on b.ctcsSeq = a.ctcsSeq
		WHERE 1=1 
			AND b.ctcsSeq = #{ctcsSeq}
			AND b.mmSeq = #{mmSeq}
	</select>
	
<!-- 	게시물 리스트 -->
	<select id="selectListPost" resultMap="resultMapObj">
		SELECT
			a.ctptSeq
			,a.ctptTitle
			,a.ctptWriter
			,a.ctptContent 
			,a.regDateTime
			,a.ctptLike1
			,a.ctptLike2
			,a.ctptLike3
			,b.ctboTypeCd
		FROM
			ctPost a 
			LEFT JOIN ctBoard b on b.ctboSeq = a.ctboSeq
		WHERE 1=1
			AND b.ctcsSeq = #{ctcsSeq}
	</select>
	
<!-- 게시글 등록 -->	
	<insert id="insertPost">
        insert into ctPost (
            ctptTitle,
			ctptContent,
			ctptWriter,
			regDateTime
			)
        values(
        	#{ctptTitle},
        	#{ctptContent},
        	#{ctptWriter},
        	#{regDateTime}
        	)
	</insert>	
	
	
<!-- 	과제 리스트 -->	
	<select id="selectListHomework" resultMap="resultMapObj">
		SELECT
			a.cthpSeq
			,a.cthpTitle
			,a.cthpWriter
			,a.cthpDesc
			,a.cthpData 
			,a.cthpEndDateTime
			,a.cthpUseNy
			,a.cthpDelNy
			,a.regDateTime
		FROM
			ctHomeworkPost a 
			LEFT JOIN ctHomework b on b.cthwSeq = a.cthwSeq
		WHERE 1=1
			AND b.ctcsSeq = #{ctcsSeq}
	</select>
	


</mapper>